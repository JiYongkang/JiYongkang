<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>三层交换机配置DHCP为不同VLAN分配IP地址</title>
      <link href="/2019/05/18/%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2DHCP/"/>
      <url>/2019/05/18/%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2DHCP/</url>
      
        <content type="html"><![CDATA[<p>三层交换的原理以及DHCP的原理，作者在这里就不详细的解释了，在这里通过一个案例来了解使用三层交换做DHCP服务器，并为不同网段分配IP地址。在生产环境中，使用路由器或交换机做DHCP服务器要常见一些。</p><h1 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h1><p>1、在SW1上配置DHCP服务，能够为以下四个不同部门分配不同网段的IP地址。<br>2、在SW1上配置VTP Server，在SW2和SW3上配置VTP Client，并将指定部门加入相关VLAN。<br>3、注意：交换机和交换机之间使用中继链路，而与路由器之间则不需要</p><h1 id="R1配置如下："><a href="#R1配置如下：" class="headerlink" title="R1配置如下："></a>R1配置如下：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#配置路由器内网接口IP和外网接口IP</span><br><span class="line">R1(config)#int f0/0</span><br><span class="line">R1(config-if)#ip add 10.0.0.2 255.0.0.0</span><br><span class="line">R1(config-if)#no sh</span><br><span class="line">R1(config-if)#no shutdown</span><br><span class="line">R1(config-if)#exit</span><br><span class="line">R1(config)#int f1/0</span><br><span class="line">R1(config-if)#ip add 202.106.123.1 255.255.255.248</span><br><span class="line">R1(config-if)#no sh</span><br><span class="line">R1(config-if)#no shutdown</span><br><span class="line">#配置到内网的静态路由条目</span><br><span class="line">R1(config)#ip route 192.168.1.0 255.255.255.0 10.0.0.1</span><br><span class="line">R1(config)#ip route 192.168.2.0 255.255.255.0 10.0.0.1</span><br><span class="line">R1(config)#ip route 192.168.3.0 255.255.255.0 10.0.0.1</span><br><span class="line">R1(config)#ip route 192.168.4.0 255.255.255.0 10.0.0.1</span><br></pre></td></tr></table></figure><h1 id="SW1配置如下"><a href="#SW1配置如下" class="headerlink" title="SW1配置如下"></a>SW1配置如下</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#配置到路由器接口的IP地址</span><br><span class="line">SW1(config)#ip routing</span><br><span class="line">SW1(config)#int f0/0</span><br><span class="line">SW1(config-if)#no switchport</span><br><span class="line">SW1(config-if)#ip add 10.0.0.1 255.0.0.0</span><br><span class="line">SW1(config-if)#no shutdown</span><br><span class="line">#配置交换机之间的接口链路为中继链路(trunk)</span><br><span class="line">SW1(config)#int range f0/1 -2</span><br><span class="line">SW1(config-if-range)#switchport mode trunk</span><br><span class="line">SW1(config-if-range)#no sh</span><br><span class="line">#配置VTP Server</span><br><span class="line">SW1#vlan database</span><br><span class="line">SW1(vlan)#vtp domain test</span><br><span class="line">SW1(vlan)#vtp server</span><br><span class="line">SW1(vlan)#vtp password 123</span><br><span class="line">SW1(vlan)#vtp pruning</span><br><span class="line">#创建vlan(为四个部门创建不同的vlan)</span><br><span class="line">SW1#vlan database</span><br><span class="line">SW1(vlan)#vlan 10</span><br><span class="line">SW1(vlan)#vlan 20</span><br><span class="line">SW1(vlan)#vlan 30</span><br><span class="line">SW1(vlan)#vlan 40</span><br><span class="line">#配置vlan虚拟接口地址</span><br><span class="line">SW1(config-if)#intvlan 10</span><br><span class="line">SW1(config-if)#ip add 192.168.1.1 255.255.255.0</span><br><span class="line">SW1(config-if)#no sh</span><br><span class="line">SW1(config-if)#exit</span><br><span class="line">SW1(config-if)#intvlan 20</span><br><span class="line">SW1(config-if)#ip add 192.168.2.1 255.255.255.0</span><br><span class="line">SW1(config-if)#no sh</span><br><span class="line">SW1(config-if)#exit</span><br><span class="line">SW1(config-if)#intvlan 30</span><br><span class="line">SW1(config-if)#ip add 192.168.3.1 255.255.255.0</span><br><span class="line">SW1(config-if)#no sh</span><br><span class="line">SW1(config-if)#exit</span><br><span class="line">SW1(config-if)#intvlan 40</span><br><span class="line">SW1(config-if)#ip add 192.168.4.1 255.255.255.0</span><br><span class="line">SW1(config-if)#no sh</span><br><span class="line">#注意：如果要配置DHCP中继服务，需要在vlan虚接口中添加一条DHCP服务器的地址SW1(config-if)#ip helper-address [DHCP服务器地址]</span><br><span class="line">#配置一条默认路由，使能够访问外网</span><br><span class="line">SW1(config)#ip route 0.0.0.0 0.0.0.0 10.0.0.2</span><br><span class="line">#配置不同网段的DHCP地址池(因为有四个vlan，所以要配四个网段地址池)</span><br><span class="line">SW1(config)#ipdhcp pool vlan10</span><br><span class="line">SW1(dhcp-config)#network 192.168.1.0 255.255.255.0</span><br><span class="line">SW1(dhcp-config)#default-router 192.168.1.1</span><br><span class="line">SW1(dhcp-config)#dns-server 202.106.0.20</span><br><span class="line">SW1(dhcp-config)#lease 2</span><br><span class="line">SW1(dhcp-config)#exit</span><br><span class="line">SW1(config)#ipdhcp pool vlan20</span><br><span class="line">SW1(dhcp-config)#network 192.168.2.0 255.255.255.0</span><br><span class="line">SW1(dhcp-config)#default-router 192.168.2.1</span><br><span class="line">SW1(dhcp-config)#dns-server 202.106.0.20</span><br><span class="line">SW1(dhcp-config)#lease 2</span><br><span class="line">SW1(dhcp-config)#exit</span><br><span class="line">SW1(config)#ipdhcp pool vlan30</span><br><span class="line">SW1(dhcp-config)#network 192.168.3.0 255.255.255.0</span><br><span class="line">SW1(dhcp-config)#default-router 192.168.3.1</span><br><span class="line">SW1(dhcp-config)#dns-server 202.106.0.20</span><br><span class="line">SW1(dhcp-config)#lease 2</span><br><span class="line">SW1(dhcp-config)#exit</span><br><span class="line">SW1(config)#ipdhcp pool vlan40</span><br><span class="line">SW1(dhcp-config)#network 192.168.4.0 255.255.255.0</span><br><span class="line">SW1(dhcp-config)#default-router 192.168.4.1</span><br><span class="line">SW1(dhcp-config)#dns-server 202.106.0.20</span><br><span class="line">SW1(dhcp-config)#lease 2</span><br><span class="line">#注意：如果要设置保留地址可以配置ipdhcp excluded-address low-address [high-address]</span><br></pre></td></tr></table></figure><h1 id="SW2配置如下"><a href="#SW2配置如下" class="headerlink" title="SW2配置如下"></a>SW2配置如下</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#配置与三层交换的链路为中继链路(trunk)</span><br><span class="line">SW2(config)#int f0/0</span><br><span class="line">SW2(config-if)#switchport mode trunk</span><br><span class="line">SW2(config-if)#no sh</span><br><span class="line">#配置VTP client(配置完VTP client后能够学习三层交换上创建的vlan)</span><br><span class="line">SW2#vlan database</span><br><span class="line">SW2(vlan)#vtp domain test</span><br><span class="line">SW2(vlan)#vtp client</span><br><span class="line">SW2(vlan)#vtp password 123</span><br><span class="line">SW2(vlan)#vtp pruning</span><br><span class="line">#将指定的接口加入到相应的vlan中</span><br><span class="line">SW2(config)#int f0/1</span><br><span class="line">SW2(config-if)#switchport access vlan 10</span><br><span class="line">SW2(config-if)#no sh</span><br><span class="line">SW2(config-if)#exit</span><br><span class="line">SW2(config-if)#int f0/2</span><br><span class="line">SW2(config-if)#switchport access vlan 20</span><br><span class="line">SW2(config-if)#no sh</span><br></pre></td></tr></table></figure><h1 id="SW3配置如下"><a href="#SW3配置如下" class="headerlink" title="SW3配置如下"></a>SW3配置如下</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#配置与三层交换的链路为中继链路(trunk)</span><br><span class="line">SW3(config)#int f0/0</span><br><span class="line">SW3(config-if)#switchport mode trunk</span><br><span class="line">SW3(config-if)#no sh</span><br><span class="line">#配置VTP client(配置完VTP client后能够学习三层交换上创建的vlan)</span><br><span class="line">SW3#vlan database</span><br><span class="line">SW3(vlan)#vtp domain test</span><br><span class="line">SW3(vlan)#vtp client</span><br><span class="line">SW3(vlan)#vtp password 123</span><br><span class="line">SW3(vlan)#vtp pruning</span><br><span class="line">#将指定的接口加入到相应的vlan中</span><br><span class="line">SW3(config)#int f0/1</span><br><span class="line">SW3(config-if)#switchport access vlan 30</span><br><span class="line">SW3(config-if)#no sh</span><br><span class="line">SW3(config-if)#exit</span><br><span class="line">SW3(config-if)#int f0/2</span><br><span class="line">SW3(config-if)#switchport access vlan 40</span><br><span class="line">SW3(config-if)#no sh</span><br></pre></td></tr></table></figure><p>配置完以上的所有配置后，在客户端将IP地址设置为DHCP自动获取，就可以获取相应的IP了，并且可以访问互联网了</p>]]></content>
      
      
      <categories>
          
          <category> 网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DHCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PPTP搭建</title>
      <link href="/2019/05/15/PPTP%E6%90%AD%E5%BB%BA/"/>
      <url>/2019/05/15/PPTP%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="1-你所需要的软件"><a href="#1-你所需要的软件" class="headerlink" title="1.你所需要的软件"></a>1.你所需要的软件</h1><p>pppd    ppp拨号服务器<br>pptpd   在pppd拨号的基础上增加pptpd的支持</p><h1 id="2-确定你的内核是否支持mppe"><a href="#2-确定你的内核是否支持mppe" class="headerlink" title="2. 确定你的内核是否支持mppe"></a>2. 确定你的内核是否支持mppe</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe ppp-compress-18 &amp;&amp; echo ok</span><br></pre></td></tr></table></figure><p>如果显示ok，那么恭喜，你的内核已经具备了mppe支持。请到第4部分</p><h1 id="3-升级内核支持mppe"><a href="#3-升级内核支持mppe" class="headerlink" title="3. 升级内核支持mppe"></a>3. 升级内核支持mppe</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://poptop.sourceforge.net/yum/stable/packages/dkms-2.0.17.5-1.noarch.rpm</span><br><span class="line">wget http://poptop.sourceforge.net/yum/stable/packages/kernel_ppp_mppe-1.0.2-3dkms.noarch.rpm</span><br></pre></td></tr></table></figure><p>dkms是一个新的软件，能让你在不编译内核的基础上，外挂一些内核的模块。<br>kernel_ppp_mppe就是mppe支持的内核模块了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh dkms-2.0.17.5-1.noarch.rpm</span><br><span class="line">rpm -ivh kernel_ppp_mppe-1.0.2-3dkms.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>以上二个是为CENTOS加载MPPE[MICROSOFT的加密协议] ..不安装的话就不能使用加密连接<br>ok后重起你的系统</p><h1 id="4-安装ppp"><a href="#4-安装ppp" class="headerlink" title="4. 安装ppp"></a>4. 安装ppp</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install ppp</span><br><span class="line">或者</span><br><span class="line">rpm －Uvh  ppp-2.4.2-b3.i386.rpm</span><br></pre></td></tr></table></figure><p><eg></eg></p><h1 id="5-安装pptpd"><a href="#5-安装pptpd" class="headerlink" title="5. 安装pptpd"></a>5. 安装pptpd</h1><p>(1)使用yum安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/Doylenet.repo</span><br><span class="line">    [doylenet]</span><br><span class="line">    name=Doylenet custom repository for CentOS</span><br><span class="line">    baseurl=http://files.doylenet.net/linux/yum/centos/5/i386/doylenet/</span><br><span class="line">    gpgcheck=1</span><br><span class="line">    gpgkey=http://files.doylenet.net/linux/yum/centos/RPM-GPG-KEY-rdoyle</span><br><span class="line">    enabled=1</span><br><span class="line">    # yum update</span><br><span class="line">    # yum install pptpd</span><br></pre></td></tr></table></figure></p><p>(2)rpm下载安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://ftp.ntua.gr/pub/net/poptop/pptpd/pptpd-1.3.1/pptpd-1.1.3-4.i386.rpm</span><br><span class="line">rpm －ivh  pptpd-1.1.3-4.i386.rpm</span><br></pre></td></tr></table></figure></p><p>注意32位或者64位版本，否则吃大亏！鄙人就是在64位服务器上装了32位的pptpd，就给搞了很长时间才发现！！ </p><h1 id="6-配置你的pppd和pptpd"><a href="#6-配置你的pppd和pptpd" class="headerlink" title="6. 配置你的pppd和pptpd"></a>6. 配置你的pppd和pptpd</h1><p>/etc/pptpd.conf中需要配置的地方只有几个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">option /etc/ppp/options.pptpd</span><br></pre></td></tr></table></figure></p><p>logwtmp 如果日志里出现类似以下问题一定要注释掉logwtmp！！！！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Jun 21 15:39:55 center pppd[1374]: /usr/lib/pptpd/pptpd-logwtmp.so: wrong ELF class: ELFCLASS32</span><br><span class="line">Jun 21 15:39:55 center pppd[1374]: Couldn&apos;t load plugin /usr/lib/pptpd/pptpd-logwtmp.so</span><br><span class="line">localip 192.168.9.1</span><br><span class="line">remoteip 192.168.9.11-30</span><br></pre></td></tr></table></figure></p><p>配置pptpd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/etc/ppp/options.pptpd</span><br><span class="line">    name pptpd</span><br><span class="line">    refuse-pap</span><br><span class="line">    refuse-chap</span><br><span class="line">    refuse-mschap</span><br><span class="line">    require-mschap-v2</span><br><span class="line">    require-mppe-128</span><br><span class="line">    proxyarp</span><br><span class="line">    lock</span><br><span class="line">    nobsdcomp</span><br><span class="line">    novj</span><br><span class="line">    novjccomp</span><br><span class="line">    nologfd</span><br><span class="line">    idle 2592000</span><br><span class="line">    ms-dns 8.8.8.8</span><br><span class="line">    ms-dns 8.8.4.4</span><br></pre></td></tr></table></figure></p><p>编辑 /etc/ppp/chap-secrets<br>添加一个测试用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/ppp/chap-secrets</span><br><span class="line"># Secrets for authentication using CHAP</span><br><span class="line"># client     server   secret      IP addresses</span><br><span class="line">test      pptpd    test           *</span><br></pre></td></tr></table></figure></p><p>第一个test是用户，第二个test是密码 ，*表示任意ip<br>配置文件/etc/sysctl.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = 1      修改为“1”内容开启ip转发：</span><br></pre></td></tr></table></figure></p><p>保存、退出后执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></p><p><eg></eg></p><h1 id="7-打开防火墙端口"><a href="#7-打开防火墙端口" class="headerlink" title="7. 打开防火墙端口"></a>7. 打开防火墙端口</h1><p>将Linux服务器的1723端口和47端口打开，并打开GRE协议。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 1723 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 47 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p gre -j ACCEPT</span><br><span class="line">iptables -A POSTROUTING -t nat -s 192.168.9.0/24 -o eth0 -j MASQUERADE</span><br><span class="line">iptables -A INPUT -p UDP --dport 53 -j ACCEPT</span><br></pre></td></tr></table></figure></p><p>这个最蛋疼，开始没注意，能连接上怎么都打不开网页，搞了半天才发现DNS端口没有打开，差点昏死过去！！<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables save</span><br></pre></td></tr></table></figure></p><p><eg></eg></p><h1 id="8-测试pptpd"><a href="#8-测试pptpd" class="headerlink" title="8. 测试pptpd"></a>8. 测试pptpd</h1><p>如果是默认安装，你在任意路径打pptpd就可以了。<br>如果成功，用以下命令看到日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail /var/log/messages</span><br><span class="line">   Feb 10 09:51:46 kdfng pptpd[926]: MGR: Manager process started</span><br><span class="line">   Feb 10 09:51:46 kdfng pptpd[926]: MGR: Maximum of 100 connections available</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VPN </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
